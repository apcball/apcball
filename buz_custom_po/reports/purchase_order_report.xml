<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Define Paper Format -->
    <record id="paperformat_purchase_order" model="report.paperformat">
        <field name="name">Purchase Order A4</field>
        <field name="default" eval="True"/>
        <field name="format">A4</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">10</field>
        <field name="margin_bottom">10</field>
        <field name="margin_left">4</field>
        <field name="margin_right">4</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">8</field>
        <field name="dpi">90</field>
    </record>

    <!-- Report Template -->
    <template id="report_purchaseorder_document_custom">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                    <div class="page">

                        <style>
                            @page {
                                margin-top: 0mm;
                                margin-bottom: 10mm;
                                margin-left: 10mm;
                                margin-right: 10mm;
                            }
                            
                            body, .page, .row {
                                margin-top: 0 !important;
                                padding-top: 0 !important;
                            }
                            
                            html, body, page, table, th, td, div, p, span, h1, h2, h3, h4, h5, h6 {
                                font-family: 'Sarabun', sans-serif !important;
                                font-size: 20px;
                            }
                            
                            .table {
                                border-collapse: collapse !important;
                                width: 100%;
                            }
                            
                            .table td,
                            .table th {
                                border-width: 0.5px !important;
                                border-style: solid !important;
                                border-color: #000 !important;
                                padding:  1px 1px;
                            }

                            .order-line-table th,
                            .order-line-table td {
                                padding-top: 10px !important;
                                padding-bottom: 10px !important;
                               line-height: 1.1 !important;
                            }
                            
                            .no-inner-borders td,
                            .no-inner-borders th {
                                border: none !important;
                            }
                            
                            .table-bordered,
                            .table-bordered td,
                            .table-bordered th {
                                border: none !important;
                            }

                            .page {
                                page-break-after: always;
                            }
                            .page:last-child {
                                page-break-after: auto;
                            }

                            .page-break {
                                page-break-after: always;
                              }

                            .vendor-info, .delivery-info {
                                font-size: 14px;
                            }
                        </style>

                         <!-- ส่วนหัว (Header) -->
                         <div class="row mb-2">
                            <div class="col-8">
                                <div style="font-size: 16px;">
                                    <div class="mb-1"><strong>บริษัท โมเก้น จำกัด (สำนักงานใหญ่)</strong></div>
                                    <div style="font-size: 14px;">9 หมู่ 12 ตำบลบึงคำพร้อย อำเภอลำลูกกา จ.ปทุมธานี 12150</div>
                                    <div style="font-size: 14px;">เลขที่ประจำตัวผู้เสียภาษี 0105547076103</div>
                                    <div style="font-size: 14px;">โทร 02 1509710 แฟกซ์ 02 1528803 E-mail: contact@mogen.co.th</div>
                                </div>
                            </div>
                            <div class="col-4 text-end">
                                <img t-if="o.company_id.logo" t-att-src="image_data_uri(o.company_id.logo)" 
                                     style="width: 180px; height: auto; object-fit: contain;" alt="Company Logo"/>
                            </div>
                        </div>

                        <!-- Document Title -->
                        <div class="row mb-2">
                           <div class="col-12 text-center">
                                <h2 style="margin: 0; padding: 0; font-weight: bold; font-size: 20px; margin-top: 10px;">ใบสั่งซื้อ / PURCHASE ORDER</h2>
                           </div>
                        </div>

                           <!-- Document Info -->
                        <div class="row mb-2">
                            <div class="col-8">
                                <p style="margin-bottom: 0; margin-top: 20px; font-size: 14px;">กรุณาแนบใบสั่งซื้อทุกครั้งที่ส่งของและวางบิล</p>
                            </div>
                            <div class="col-4">
                                <div class="text-end" style="font-size: 14px;">
                                    <div>เลขที่/NO.: <strong><span t-field="o.name"/></strong></div>
                                    <div>วันที่/DATE: <strong><span t-field="o.date_order" t-options='{"widget": "date", "format": "dd/MM/yyyy"}'/></strong></div>
                                    <div>หน้า/PAGE: <t t-esc="(page_num or 0) + 1"/> / <t t-esc="total_pages"/></div>
                                </div>
                            </div>
                        </div>

                        <!-- กล่องนอก -->
                        <div style="width: 100%; border: 1px solid #000; padding: 0; font-size: 20px; box-sizing: border-box;">
                            <div style="display: flex; gap: 0;">

                                <!-- ฝั่งซ้าย: 40% -->
                                <div style="width: 40%; padding: 0; box-sizing: border-box; border-right: 1px solid #000;">
                                    <div class="mb-1" style="margin-bottom:0; padding: 4px;">
                                        <strong style="display: inline-block; width: 35%;">ผู้ขาย/VENDOR:</strong>
                                        <span t-field="o.partner_id.name"/>
                                    </div>
                                    <div class="mb-1" style="margin-bottom:0; padding: 4px;">
                                        <strong style="display: inline-block; width: 35%;">ที่อยู่/ADDRESS:</strong>
                                        <span t-field="o.partner_id.street"/>
                                        <span t-if="o.partner_id.street2" t-field="o.partner_id.street2"/>
                                    </div>
                                    <div class="mb-1" style="margin-bottom:0; padding: 4px;">
                                        <strong style="display: inline-block; width: 35%;">เลขประจำตัวผู้เสียภาษี:</strong>
                                        <span t-field="o.partner_id.vat"/>
                                    </div>
                                    <div class="mb-1" style="margin-bottom:0; padding: 4px;">
                                        <strong style="display: inline-block; width: 35%;">โทรศัพท์/TEL:</strong>
                                        <span t-field="o.partner_id.phone"/>
                                    </div>
                                    <div class="mb-1" style="margin-bottom:0; padding: 4px;">
                                        <strong style="display: inline-block; width: 35%;">อีเมล/EMAIL:</strong>
                                        <span t-field="o.partner_id.email"/>
                                    </div>
                                </div>

                                <!-- ฝั่งขวา: 60% -->
                                 <div style="width: 60%; padding: 0; box-sizing: border-box;">
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <tbody>
                                            <!-- บรรทัดที่ 1 -->
                                            <tr>
                                                <td style="width: 40%; border-bottom: 1px solid #000; padding: 1px;" colspan="2">
                                                    <strong>สถานที่ส่ง:</strong>
                                                    <span t-field="o.picking_type_id.warehouse_id.partner_id.name"/>
                                                    <br/>
                                                    <span t-field="o.picking_type_id.warehouse_id.partner_id.street"/>
                                                    <br/>
                                                    <span t-field="o.picking_type_id.warehouse_id.partner_id.street2"/>
                                                </td>
                                                <td style="width: 60%; border-left: 1px solid #000; border-bottom: 1px solid #000; padding: 1px;" colspan="2">
                                                    <strong>ผู้ขายยืนยันรับ:</strong>
                                                    <br/><br/><br/>
                                                </td>
                                            </tr>
                                            <!-- บรรทัดที่ 2 -->
                                            <tr>
                                                <td style="width: 40%; border-bottom: 1px solid #000; padding: 4px;" colspan="2">
                                                    <strong>แผนกที่ขอซื้อ:</strong>
                                                    <t t-if="o.department_name">
                                                        <span t-esc="o.department_name"/>
                                                    </t>
                                                    <t t-else="">
                                                        <span>-</span>
                                                    </t>
                                                </td>
                                                <td style="width: 60%;border-bottom: 1px solid #000; border-left: 1px solid #000; padding: 4px;" colspan="2">
                                                    <strong>วันที่:</strong>
                                                    <span t-esc="o.date_order.strftime('%d/%m/%Y')"/>
                                                </td>
                                            </tr>
                                            <!-- บรรทัดที่ 3 -->
                                            <tr>
                                                <td style="width: 32%; border-bottom: 1px ; border-left: 1px solid #fff; padding: -8px;">
                                                   <strong>ผู้ติดต่อ:</strong> <span t-field="o.user_id.name"/>
                                                </td>
                                                <td style="width: 38%; border-bottom: 1px ; border-left: 1px solid #000; padding: -8px;">
                                                    <strong>ใบขอซื้อเลขที่:</strong> <span t-field="o.name"/>
                                                </td>
                                                <td style="width: 18%; border-bottom: 1px ; border-left: 1px solid #000; padding: -8px;">
                                                    <strong>Credit:</strong> <span t-field="o.partner_id.credit_limit"/>
                                                </td>
                                                <td style="width: 12%; border-bottom: 1px ; border-left: 1px solid #000; padding: -8px;">
                                                    <strong>เงื่อนไขฯ:</strong>
                                                    <br/><br/>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                            </div>
                        </div>



                       <table class="table table-sm mt-4 order-line-table" style="border-collapse: collapse; width: 100%;">
                          <thead>
                            <tr>
                                <th style="width: 4%; text-align: center; border: 1px solid black; padding: 2px 3px;">ลำดับ<br/><span style="font-size: 16px;">(No)</span></th>
                                <th style="width: 10%; text-align: center; border: 1px solid black; padding: 2px 3px;">รหัสสินค้า<br/><span style="font-size: 16px;">(Item No)</span></th>
                                <th style="width: 20%; text-align: center; border: 1px solid black; padding: 2px 3px;">รายการสินค้า<br/><span style="font-size: 16px;">(Description)</span></th>
                                <th style="width: 10%; text-align: center; border: 1px solid black; padding: 2px 3px;">วันที่ส่ง<br/><span style="font-size: 16px;">(Delivery Date)</span></th>
                                <th style="width: 8%; text-align: center; border: 1px solid black; padding: 2px 3px;">จำนวน<br/><span style="font-size: 16px;">(Qty)</span></th>
                                <th style="width: 8%; text-align: center; border: 1px solid black; padding: 2px 3px;">หน่วย<br/><span style="font-size: 16px;">(Unit)</span></th>
                                <th style="width: 10%; text-align: center; border: 1px solid black; padding: 2px 3px;">ราคา/หน่วย<br/><span style="font-size: 16px;">(Unit Price)</span></th>
                                <th style="width: 8%; text-align: center; border: 1px solid black; padding: 2px 3px;">ส่วนลด<br/><span style="font-size: 16px;">(Discount)</span></th>
                                <th style="width: 12%; text-align: center; border: 1px solid black; padding: 2px 3px;">จำนวนเงิน<br/><span style="font-size: 16px;">(Amount)</span></th>
                            </tr>
                          </thead>
                          <tbody>
                            <t t-set="page_number" t-value="1"/>
                            <t t-set="line_number" t-value="((page_number - 1) * 7) + 1"/>
                            <t t-set="current_line_number" t-value="line_number or 1"/>
                            <t t-foreach="o.order_line" t-as="line">
                                <tr style="font-size: 18px;">

                                    <td style="text-align: center; border: 1px solid black; background-color: #f9f9f9; padding: 2px 3px;">
                                        <span t-esc="current_line_number"/>
                                    </td>
                                    <td style="border: 1px solid black; padding: 2px 3px;"><span t-field="line.product_id.default_code"/></td>
                                    <td style="border: 1px solid black; padding: 2px 3px;"><span t-field="line.product_id.name"/></td>
                                    <td style="text-align: center; border: 1px solid black; padding: 2px 3px;"><span t-field="line.date_planned"/></td>
                                    <td style="text-align: right; border: 1px solid black; padding: 2px 3px;"><span t-esc="'%.0f' % line.product_uom_qty"/></td>
                                    <td style="text-align: center; border: 1px solid black; padding: 2px 3px;"><span t-field="line.product_uom.name"/></td>
                                    <td style="text-align: right; border: 1px solid black; padding: 2px 3px;"><span t-esc="'{:,.2f}'.format(line.price_unit)"/></td>
                                    <td style="text-align: right; border: 1px solid black; padding: 2px 3px;"><span t-esc="'{:,.2f}'.format(line.discount)"/>%</td>
                                    <td style="text-align: right; border: 1px solid black; padding: 2px 3px;">
                                        <t t-set="subtotal" t-value="line.product_uom_qty * line.price_unit * (1 - (line.discount or 0.0)/100)"/>
                                        <span t-esc="'{:,.2f}'.format(subtotal)"/>
                                    </td>
                                </tr>
                                <t t-set="current_line_number" t-value="current_line_number + 1"/>
                            </t>
                          </tbody>
                        </table>

                                <!-- หมายเหตุและตารางสรุป -->
                                <div style="display: flex; flex-direction: row; align-items: flex-start; justify-content: space-between; width: 100%; margin-top: 10px; gap: 2%;">
                                    <!-- กล่องซ้าย: หมายเหตุ + จำนวนเงินตัวอักษร -->
                                    <div style="width: 60%; border: 1px solid #000; padding: 15px; font-size: 22px; box-sizing: border-box;">
                                        <!-- บรรทัดที่ 1: หมายเหตุ -->
                                        <div style="display: flex; flex-direction: row; width: 100%;">
                                            <div style="width: 100%;">
                                                <strong style="font-size: 20px;">หมายเหตุ:</strong>
                                                <div t-if="'note' in o._fields and o.note" style="margin-top: 5px;">
                                                    <span t-field="o.note" style="font-size: 22px;"/>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- บรรทัดที่ 2: จำนวนเงินตัวอักษร -->
                                        <div style="display: flex; flex-direction: row; width: 100%; margin-top: 15px;">
                                            <!-- ช่องที่ 1: label -->
                                            <div style="width: 50%; font-size: 20px;">
                                                <strong>จำนวนเงิน (ตัวอักษร):</strong>
                                            </div>
                                            <!-- ช่องที่ 2: แปลงจำนวนเงินเป็นตัวหนังสือไทย -->
                                            <div style="width: 50%;">
                                                <t t-set="amount_total_text" t-value="num2words(amount_total, lang='th')" />
                                                <span t-esc="amount_total_text" />
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- กล่องขวา: ตารางสรุปยอด -->
                                    <div style="width: 40%; text-align: right;">
                                        <table class="table" style="font-size: 14px; width: 100%; margin: 0; padding: 0; border-collapse: collapse;">
                                            <tr>
                                                <td style="width: 55%; text-align: left; padding: 4px; border: 0.5px solid #dee2e6;">
                                                    <span>ราคารวม/Total:</span>
                                                </td>
                                                <td style="width: 45%; text-align: right; padding: 4px; border: 0.5px solid #dee2e6;">
                                                    <span t-esc="'{:,.2f}'.format(amount_untaxed if amount_untaxed is not None else 0.00)"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="text-align: left; padding: 4px; border: 0.5px solid #dee2e6;">
                                                    <span>ส่วนลด/Discount:</span>
                                                </td>
                                                <td style="text-align: right; padding: 4px; border: 0.5px solid #dee2e6;">
                                                    <span t-esc="'{:,.2f}'.format(total_discount if total_discount is not None else 0.00)"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="text-align: left; padding: 4px; border: 0.5px solid #dee2e6;">
                                                    <span>ค่าขนส่ง/Shipping Fee:</span>
                                                </td>
                                                <td style="text-align: right; padding: 4px; border: 0.5px solid #dee2e6;">
                                                    <span t-esc="'{:,.2f}'.format(shipping_fee if shipping_fee is not None else 0.00)"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="text-align: left; padding: 4px; border: 0.5px solid #dee2e6;">
                                                    <span>ส่วนลด/Discount:</span>
                                                </td>
                                                <td style="text-align: right; padding: 4px; border: 0.5px solid #dee2e6;">
                                                    <span t-esc="'{:,.2f}'.format(total_discount if total_discount is not None else 0.00)"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="text-align: left; padding: 4px; border: 0.5px solid #dee2e6;">
                                                    <span>ภาษีมูลค่าเพิ่ม/VAT 7%:</span>
                                                </td>
                                                <td style="text-align: right; padding: 4px; border: 0.5px solid #dee2e6;">
                                                    <span t-esc="'{:,.2f}'.format(amount_tax if amount_tax is not None else 0.00)"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="text-align: left; padding: 4px; border: 0.5px solid #dee2e6;">
                                                    <span>รวมทั้งสิ้น/Grand Total:</span>
                                                </td>
                                                <td style="text-align: right; padding: 4px; border: 0.5px solid #dee2e6;">
                                                    <span t-esc="'{:,.2f}'.format(amount_total if amount_total is not None else 0.00)"/>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>

  
                 
                    </div>
                    
                </t></t>
                </t>
            </template>   
    <!-- Report Action -->
    <record id="action_report_purchase_order_custom" model="ir.actions.report">
        <field name="name">Custom Purchase Order</field>
        <field name="model">purchase.order</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">buz_custom_po.report_purchaseorder_document_custom</field>
        <field name="report_file">buz_custom_po.report_purchaseorder_document_custom</field>
        <field name="print_report_name">'Purchase Order - %s' % object.name</field>
        <field name="binding_model_id" ref="purchase.model_purchase_order"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="paperformat_purchase_order"/>
    </record>
</odoo>